<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atelier Paneli - Kadraj l'Atelier</title>
    <script src="https://www.google.com/recaptcha/api.js?render=6Lf27pwrAAAAAGpNHmTIustfAC525FaEF5PA12Kc"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCqrcT7QY6tsYJidztDDu2BZhU7hLZF-ZE",
            authDomain: "kadrajatelier-7e02a.firebaseapp.com",
            projectId: "kadrajatelier-7e02a",
            storageBucket: "kadrajatelier-7e02a.firebaseapp.com",
            messagingSenderId: "4259035875263",
            appId: "1:4259035875263:web:d1002c3816e86b4be52a0a"
        };
        
        const app = initializeApp(firebaseConfig);

        // SİTE ANAHTARINIZ EKLENDİ
        const appCheck = initializeAppCheck(app, {
          provider: new ReCaptchaV3Provider('6Lf27pwrAAAAAGpNHmTIustfAC525FaEF5PA12Kc'),
          isTokenAutoRefreshEnabled: true
        });

        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        
        window.firebaseAuth = auth;
        window.firebaseFirestore = db;
        window.firebaseStorage = storage;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
        window.doc = doc;
        window.getDoc = getDoc;
        window.collection = collection;
        window.addDoc = addDoc;
        window.serverTimestamp = serverTimestamp;
        window.ref = ref;
        window.uploadBytesResumable = uploadBytesResumable;
        window.getDownloadURL = getDownloadURL;
    </script>
    <style>
        .progress-bar {
            transition: width 0.3s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 font-['Helvetica'] text-gray-800">
    <div id="root"></div>
    <script type="text/babel">
        // --- ICONS (No changes) ---
        const UserIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const LayoutDashboardIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>;
        const BoxIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>;
        const DollarSignIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
        const LogOutIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="17 17 22 12 17 7"/><line x1="22" x2="10" y1="12" y2="12"/></svg>;
        const SearchIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>;
        const EyeIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>;
        const HeartIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>;
        const PackageIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size} height={props.size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="m7.5 4.27 9 5.16"/><path d="M2.5 8.67 12 14l9.5-5.33"/><path d="M12 22V14"/><path d="M2.5 17.33 12 22l9.5-4.67"/><path d="M2.5 12l9.5 5.5 9.5-5.5"/></svg>;

        const translations = { /* ... Sizin çeviri objeniz burada ... */ };

        // --- HELPER COMPONENTS (No changes) ---
        const Input = ({ label, type = 'text', placeholder, value, onChange, required = true }) => ( <div> <label className="block text-sm font-medium text-gray-700 mb-2">{label}</label> <input type={type} placeholder={placeholder} value={value} onChange={onChange} required={required} className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-gray-300 focus:border-gray-300 transition" /> </div> );
        const TextArea = ({ label, placeholder, value, onChange, required = true }) => ( <div> <label className="block text-sm font-medium text-gray-700 mb-2">{label}</label> <textarea placeholder={placeholder} value={value} onChange={onChange} required={required} rows="4" className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-gray-300 focus:border-gray-300 transition" ></textarea> </div> );
        const Select = ({ label, options, value, onChange, required = true }) => ( <div> <label className="block text-sm font-medium text-gray-700 mb-2">{label}</label> <select value={value} onChange={onChange} required={required} className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-gray-300 focus:border-gray-300 transition bg-white"> <option value="">Seçiniz...</option> {options.map(option => <option key={option} value={option}>{option}</option>)} </select> </div> );
        const MetricCard = ({ title, value, description, icon }) => ( <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 flex items-start space-x-4"> <div className="bg-gray-100 p-3 rounded-lg">{icon}</div> <div> <p className="text-sm text-gray-500">{title}</p> <p className="text-2xl font-bold text-gray-800">{value}</p> <p className="text-xs text-gray-400">{description}</p> </div> </div> );
        const ProductListItem = ({ name, status, price, t }) => ( <li className="flex items-center justify-between p-3 bg-gray-50 rounded-lg"> <div> <p className="font-semibold text-gray-800">{name}</p> <p className={`text-xs font-medium ${status === t('active') ? 'text-green-600' : 'text-red-600'}`}>{status}</p> </div> <div className="text-right"> <p className="font-bold text-gray-800">{price}</p> <div className="flex space-x-2 mt-1"> <button className="text-sm text-blue-600 hover:underline">{t('edit')}</button> <button className="text-sm text-red-600 hover:underline">{t('delete')}</button> </div> </div> </li> );
        const OrderItem = ({ orderId, productName, status, date, t }) => ( <li className="p-3 bg-gray-50 rounded-lg"> <div className="flex items-center justify-between"> <div> <p className="font-semibold text-gray-800">{productName}</p> <p className="text-xs text-gray-500">{t('orderId')} {orderId}</p> </div> <p className="font-bold text-gray-800">{date}</p> </div> <div className="mt-2 text-sm font-medium text-blue-600">{status}</div> </li> );

        // --- DASHBOARD COMPONENTS (No changes in Navbar) ---
        const SadeNavbar = ({ t, isLoggedIn, setIsLoggedIn }) => { const handleLogout = async () => { try { await window.signOut(window.firebaseAuth); setIsLoggedIn(false); window.location.href = 'index.html'; } catch (error) { console.error("Çıkış yaparken hata oluştu:", error); } }; return ( <nav className="bg-white py-4 border-b border-gray-100"> <div className="container mx-auto px-6 md:px-10 flex items-center justify-between"> <div className="flex items-center w-1/3 max-w-sm px-3 py-2 border border-gray-200 rounded-lg bg-gray-50"> <SearchIcon size={20} className="text-gray-500 mr-2" /> <input type="text" placeholder={t('searchProduct')} className="flex-grow outline-none text-sm text-gray-700 placeholder-gray-400 bg-transparent" /> </div> <div className="flex-grow flex justify-center"> <img src="ana logo yatay@2x.png" alt="Kadraj l'Atelier Logo" className="h-8 cursor-pointer" onClick={() => window.location.href = 'index.html'} /> </div> <div className="flex items-center space-x-6 w-1/3 justify-end"> {isLoggedIn && ( <button onClick={handleLogout} className="flex items-center space-x-2 text-red-600 hover:text-red-700 transition duration-300 ease-in-out px-3 py-2 rounded-lg hover:bg-red-50"> <LogOutIcon size={20} /> <span>{t('logout')}</span> </button> )} </div> </div> </nav> ); };
        
        // --- Main SellerDashboard Component (No other changes) ---
        const SellerDashboard = ({ currentUser, t }) => {
            const [activeTab, setActiveTab] = React.useState('overview');
            // Form state
            const [productName, setProductName] = React.useState('');
            const [description, setDescription] = React.useState('');
            const [story, setStory] = React.useState('');
            const [price, setPrice] = React.useState('');
            const [category, setCategory] = React.useState('');
            const [material, setMaterial] = React.useState('');
            const [dimensions, setDimensions] = React.useState('');
            const [weight, setWeight] = React.useState('');
            const [shippingInfo, setShippingInfo] = React.useState('');
            const [files, setFiles] = React.useState([]);
            // UI state
            const [isUploading, setIsUploading] = React.useState(false);
            const [uploadProgress, setUploadProgress] = React.useState(0);
            const [feedback, setFeedback] = React.useState('');

            const resetForm = () => {
                setProductName(''); setDescription(''); setStory(''); setPrice('');
                setCategory(''); setMaterial(''); setDimensions(''); setWeight('');
                setShippingInfo(''); setFiles([]);
                document.getElementById('file-input').value = null;
            };

            const handleSaveProduct = async (e) => {
                e.preventDefault();
                setIsUploading(true);
                setFeedback('Yükleme işlemi başlatılıyor...');
                setUploadProgress(0);

                const allFiles = Array.from(files);
                const imageFiles = allFiles.filter(file => file.type.startsWith('image/'));
                const videoFiles = allFiles.filter(file => file.type.startsWith('video/'));

                if (imageFiles.length === 0) {
                    setFeedback('Hata: Lütfen en az bir ürün fotoğrafı yükleyin.');
                    setIsUploading(false);
                    return;
                }
                if (videoFiles.length > 1) {
                    setFeedback('Hata: Sadece bir adet video yükleyebilirsiniz.');
                    setIsUploading(false);
                    return;
                }

                const uploadFile = (file) => {
                    return new Promise((resolve, reject) => {
                        const fileName = `${Date.now()}-${file.name}`;
                        const storageRef = window.ref(window.firebaseStorage, `products/${fileName}`);
                        const uploadTask = window.uploadBytesResumable(storageRef, file);
                        uploadTask.on('state_changed', 
                            (snapshot) => {
                                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                                setUploadProgress(progress);
                            }, 
                            (error) => reject(error),
                            async () => {
                                const downloadURL = await window.getDownloadURL(uploadTask.snapshot.ref);
                                resolve(downloadURL);
                            }
                        );
                    });
                };

                try {
                    setFeedback('Dosyalar yükleniyor...');
                    const imageUploadPromises = imageFiles.map(file => uploadFile(file));
                    const videoUploadPromises = videoFiles.map(file => uploadFile(file));
                    
                    const imageUrls = await Promise.all(imageUploadPromises);
                    const videoUrls = await Promise.all(videoUploadPromises);
                    
                    setFeedback('Veritabanına kaydediliyor...');
                    const productData = {
                        sellerId: currentUser.uid,
                        productName, description, story,
                        price: Number(price),
                        category, material, dimensions,
                        weight: Number(weight),
                        shippingInfo, 
                        imageUrls: imageUrls,
                        videoUrl: videoUrls.length > 0 ? videoUrls[0] : null,
                        createdAt: window.serverTimestamp()
                    };
                    
                    await window.addDoc(window.collection(window.firebaseFirestore, 'products'), productData);

                    setFeedback('Ürün başarıyla kaydedildi!');
                    resetForm();

                } catch (error) {
                    console.error("Error saving product:", error);
                    setFeedback('Ürün kaydedilirken bir hata oluştu: ' + error.message);
                } finally {
                    setIsUploading(false);
                }
            };
            
            const renderContent = () => {
                switch (activeTab) {
                    case 'overview': return (
                          <div className="space-y-6"> <h3 className="text-2xl font-semibold text-gray-800">{t('overview')}</h3> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"> <MetricCard title={t('sales')} value="₺12,500" description={`5 ${t('unitsSold')}`} icon={<DollarSignIcon size={24} className="text-green-500" />} /> <MetricCard title={t('mostPopularProduct')} value="Minimalist Sehpa" description={`120 ${t('views')}`} icon={<PackageIcon size={24} className="text-blue-500" />} /> <MetricCard title={t('productViews')} value="1.540" description={t('platformWide')} icon={<EyeIcon size={24} className="text-indigo-500" />} /> </div> </div>
                    );
                    case 'productManagement': return (
                        <div className="space-y-6">
                            <h3 className="text-2xl font-semibold text-gray-800">{t('addProductManage')}</h3>
                            <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                <h4 className="text-xl font-medium text-gray-700 mb-4">{t('addNewProduct')}</h4>
                                <form className="space-y-4" onSubmit={handleSaveProduct}>
                                    <Input label={t('productName')} placeholder="Örn: El Yapımı Seramik Vazo" value={productName} onChange={e => setProductName(e.target.value)} />
                                    <TextArea label={t('productDescription')} placeholder={t('productDescription')} value={description} onChange={e => setDescription(e.target.value)} />
                                    <TextArea label={t('productStory')} placeholder={t('productStory')} value={story} onChange={e => setStory(e.target.value)} required={false} />
                                    <Input label={t('price')} type="number" placeholder="Örn: 500" value={price} onChange={e => setPrice(e.target.value)} />
                                    <Select label={t('category')} options={[t('furniture'), t('lighting'), t('decoration'), t('artPiece')]} value={category} onChange={e => setCategory(e.target.value)} />
                                    <Input label={t('materialInfo')} placeholder="Örn: Seramik, Ahşap, Metal" value={material} onChange={e => setMaterial(e.target.value)} />
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <Input label={t('dimensionsCm')} placeholder="Örn: 20x15x10" value={dimensions} onChange={e => setDimensions(e.target.value)} />
                                        <Input label={t('weightKg')} type="number" placeholder="Örn: 2.5" value={weight} onChange={e => setWeight(e.target.value)} />
                                    </div>
                                    <TextArea label={t('shippingInfo')} placeholder={t('shippingInfo')} value={shippingInfo} onChange={e => setShippingInfo(e.target.value)} />
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">{t('professionalPhotoGallery')}</label>
                                        <input 
                                            id="file-input"
                                            type="file" 
                                            multiple 
                                            accept="image/*,video/*" 
                                            onChange={e => setFiles(e.target.files)} 
                                            className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200" 
                                        />
                                        <p className="mt-1 text-sm text-gray-500">{t('uploadPhotos')} (Max. 1 video)</p>
                                    </div>
                                    {isUploading && (
                                        <div className="w-full bg-gray-200 rounded-full h-2.5">
                                            <div className="bg-blue-600 h-2.5 rounded-full progress-bar" style={{ width: `${uploadProgress}%` }}></div>
                                        </div>
                                    )}
                                    {feedback && <p className={`text-sm font-medium ${feedback.includes('Hata') ? 'text-red-600' : 'text-green-600'}`}>{feedback}</p>}
                                    <button type="submit" disabled={isUploading} className="w-full bg-gray-800 text-white py-3 px-4 rounded-lg hover:bg-gray-900 transition duration-300 ease-in-out shadow-md disabled:bg-gray-400">
                                        {isUploading ? 'Yükleniyor...' : t('saveProduct')}
                                    </button>
                                </form>
                            </div>
                        </div>
                    );
                    case 'ordersFinance': return (
                          <div className="space-y-6"> <h3 className="text-2xl font-semibold text-gray-800">{t('ordersFinance')}</h3> <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100"> <h4 className="text-xl font-medium text-gray-700 mb-4">{t('lastOrders')}</h4> <ul className="space-y-4"> <OrderItem orderId="KDA-001" productName="Minimalist Sehpa" status={t('completed')} date="28.07.2024" t={t}/> <OrderItem orderId="KDA-002" productName="El Yapımı Seramik Vazo" status={t('inTransit')} date="29.07.2024" t={t}/> </ul> </div> </div>
                    );
                    default: return null;
                }
            };
            return (
                <div className="flex flex-col md:flex-row gap-8">
                    <div className="md:w-1/4 bg-white p-6 rounded-xl shadow-sm h-fit border border-gray-100">
                        <h2 className="text-3xl font-bold text-gray-900 mb-6">{t('atelierPanel')}</h2>
                        <ul className="space-y-3">
                            <li><button onClick={() => setActiveTab('overview')} className={`flex items-center space-x-3 w-full text-left py-3 px-4 rounded-lg transition duration-200 ${activeTab === 'overview' ? 'bg-gray-100 text-gray-800 font-semibold' : 'text-gray-700 hover:bg-gray-50'}`}><LayoutDashboardIcon size={20} /><span>{t('overview')}</span></button></li>
                            <li><button onClick={() => setActiveTab('productManagement')} className={`flex items-center space-x-3 w-full text-left py-3 px-4 rounded-lg transition duration-200 ${activeTab === 'productManagement' ? 'bg-gray-100 text-gray-800 font-semibold' : 'text-gray-700 hover:bg-gray-50'}`}><BoxIcon size={20} /><span>{t('productManagement')}</span></button></li>
                            <li><button onClick={() => setActiveTab('ordersFinance')} className={`flex items-center space-x-3 w-full text-left py-3 px-4 rounded-lg transition duration-200 ${activeTab === 'ordersFinance' ? 'bg-gray-100 text-gray-800 font-semibold' : 'text-gray-700 hover:bg-gray-50'}`}><DollarSignIcon size={20} /><span>{t('ordersFinance')}</span></button></li>
                        </ul>
                    </div>
                    <div className="md:w-3/4 bg-white p-8 rounded-xl shadow-sm border border-gray-100">
                        {renderContent()}
                    </div>
                </div>
            );
        };
        
        // --- MAIN APP (No changes) ---
        const App = () => { const [isLoggedIn, setIsLoggedIn] = React.useState(false); const [userType, setUserType] = React.useState(null); const [language, setLanguage] = React.useState('Türkçe'); const [currentUser, setCurrentUser] = React.useState(null); const [isLoading, setIsLoading] = React.useState(true); React.useEffect(() => { const unsubscribe = window.onAuthStateChanged(window.firebaseAuth, async (user) => { if (user) { const userDocRef = window.doc(window.firebaseFirestore, 'users', user.uid); const userDocSnap = await window.getDoc(userDocRef); if (userDocSnap.exists()) { const role = userDocSnap.data().role; if (role === 'seller') { setCurrentUser(user); setUserType(role); setIsLoggedIn(true); } else { window.location.href = 'index.html'; } } else { window.location.href = 'index.html'; } } else { window.location.href = 'index.html'; } setIsLoading(false); }); return () => unsubscribe(); }, []); const t = (key) => (translations[language] && translations[language][key]) || key; if (isLoading) { return <div className="flex justify-center items-center h-screen"><p>Yükleniyor...</p></div>; } if (!isLoggedIn || userType !== 'seller') { return <div className="flex justify-center items-center h-screen"><p>Yetkiniz yok veya giriş yapılmamış. Yönlendiriliyorsunuz...</p></div>; } return ( <div className="min-h-screen bg-gray-50 font-['Helvetica'] text-gray-800"> <SadeNavbar t={t} isLoggedIn={isLoggedIn} setIsLoggedIn={setIsLoggedIn} /> <main className="container mx-auto p-6 md:p-10"> <SellerDashboard currentUser={currentUser} t={t} /> </main> </div> ); };
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
